root@9cf9c6d4615a:~/test20230317base/task2# python -m src.train --gpu_ids='2' --bert_seq_length=128 --learning_rate=1e-4 --bert_learning_rate=5e-5 --savedmodel_path='data/checkpoint/0703_swa_10' --max_epochs=10  --adam_epsilon=1e-6 --weight_decay=0.01 --test_batch_size=64 --val_batch_size=64 --batch_size=16 --swa_start=5 --swa_lr=2e-5 --fgm=1
addle !!!!!!!!!!!!!!!!!!!!!!!!!!!!
The GPUS ids:  2
Some weights of the model checkpoint at roberta-base were not used when initializing RobertaModel: ['lm_head.layer_norm.bias', 'lm_head.decoder.weight', 'lm_head.bias', 'lm_head.dense.weight', 'lm_head.layer_norm.weight', 'lm_head.dense.bias']
- This IS expected if you are initializing RobertaModel from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing RobertaModel from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
The train data length:  222
The valid data length:  10
使用SWA！
2023-04-16 23:08:19 - INFO - 使用FGM进行embedding攻击！
2023-04-16 23:08:19 - INFO - Training/evaluation parameters: Namespace(adam_epsilon=1e-06, alpha=0, batch_size=16, bert_cache='data/bert_cache/', bert_dir='roberta-base', bert_embedding_size=768, bert_hidden_dropout_prob=0.1, bert_hidden_size=768, bert_learning_rate=5e-05, bert_max_steps=30000, bert_seq_length=128, bert_warmup_steps=5000, best_score=0.75, ckpt_file=None, class_label=3, constant_lr=False, device='cuda', distributed_train=False, dropout=0.3, ema_decay=0.999, ema_start=-1, embedding_freeze=False, fgm=1, gamma=0, gamma_focal=-1, gpu_ids='2', gradient_accumulation_steps=2, learning_rate=0.0001, max_epochs=10, max_grad_norm=1.0, max_steps=2220, minimum_lr=0.0, n_gpu=1, pgd=0, premise=False, pretrain_model_path=None, print_steps=100, result_file='result.tsv', save_steps=100, savedmodel_path='data/checkpoint/0703_swa_10', seed=42, swa_lr=2e-05, swa_start=5, test_batch_size=64, test_path='data/validation.tsv', train_path='data/train.tsv', use_rdrop=False, val_batch_size=64, valid_path='data/validation.tsv', warmup_rate=0.1, warmup_steps=222, weight_decay=0.01)
Training::  45%|███████████████████████████████████████████████████████████████████████▊                                                                                         | 99/222 [00:20<00:23,  5.15it/s]2023-04-16 23:08:40 - INFO - Epoch 0total_step 100eta 00:07:20:loss 0.829, acc 0.688
Evaluating: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10/10 [00:01<00:00,  9.10it/s]
2023-04-16 23:08:41 - INFO - current_score 0.5118571977772342█████████████████████████████████████████████████████████████████████████████████████████████████████▊                | 9/10 [00:01<00:00,  8.60it/s]
Training::  90%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                | 199/222 [00:41<00:04,  5.14it/s]2023-04-16 23:09:01 - INFO - Epoch 0total_step 200eta 00:06:57:loss 0.792, acc 0.688
Evaluating: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10/10 [00:01<00:00,  9.14it/s]
2023-04-16 23:09:02 - INFO - current_score 0.5919719810236719█████████████████████████████████████████████████████████████████████████████████████████████████████▊                | 9/10 [00:01<00:00,  8.56it/s]
Training:: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 222/222 [00:46<00:00,  4.75it/s]
Evaluating: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10/10 [00:01<00:00,  9.23it/s]
Training::  35%|███████████████████████████████████████████████████████▊                                                                                                         | 77/222 [00:15<00:28,  5.04it/s]2023-04-16 23:09:23 - INFO - Epoch 1total_step 300eta 00:06:44:loss 0.380, acc 0.938
Evaluating: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10/10 [00:01<00:00,  9.01it/s]
2023-04-16 23:09:24 - INFO - current_score 0.6568728290470711█████████████████████████████████████████████████████████████████████████████████████████████████████▊                | 9/10 [00:01<00:00,  8.60it/s]
Training::  80%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                | 177/222 [00:36<00:08,  5.01it/s]2023-04-16 23:09:44 - INFO - Epoch 1total_step 400eta 00:06:23:loss 0.729, acc 0.688
Evaluating: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10/10 [00:01<00:00,  9.19it/s]
2023-04-16 23:09:45 - INFO - current_score 0.6834084542908072█████████████████████████████████████████████████████████████████████████████████████████████████████▊                | 9/10 [00:01<00:00,  8.65it/s]
Training:: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 222/222 [00:46<00:00,  4.80it/s]
Evaluating: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10/10 [00:01<00:00,  8.96it/s]
Training::  25%|███████████████████████████████████████▉                                                                                                                         | 55/222 [00:10<00:33,  5.06it/s]2023-04-16 23:10:06 - INFO - Epoch 2total_step 500eta 00:06:05:loss 0.543, acc 0.750
Evaluating: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10/10 [00:01<00:00,  9.09it/s]
2023-04-16 23:10:07 - INFO - current_score 0.7023500614172862█████████████████████████████████████████████████████████████████████████████████████████████████████▊                | 9/10 [00:01<00:00,  8.55it/s]
Training::  70%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                                | 155/222 [00:31<00:13,  5.06it/s]2023-04-16 23:10:27 - INFO - Epoch 2total_step 600eta 00:05:43:loss 0.451, acc 0.938
Evaluating: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10/10 [00:01<00:00,  9.15it/s]
2023-04-16 23:10:28 - INFO - current_score 0.7163389695199769█████████████████████████████████████████████████████████████████████████████████████████████████████▊                | 9/10 [00:01<00:00,  8.61it/s]
Training:: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 222/222 [00:46<00:00,  4.81it/s]
Evaluating: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10/10 [00:01<00:00,  9.19it/s]
Training::  15%|███████████████████████▉                                                                                                                                         | 33/222 [00:06<00:37,  5.05it/s]2023-04-16 23:10:49 - INFO - Epoch 3total_step 700eta 00:05:23:loss 0.428, acc 0.875
Evaluating: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10/10 [00:01<00:00,  9.01it/s]
2023-04-16 23:10:50 - INFO - current_score 0.7355802341943353█████████████████████████████████████████████████████████████████████████████████████████████████████▊                | 9/10 [00:01<00:00,  8.56it/s]
Training::  60%|███████████████████████████████████████████████████████████████████████████████████████████████▊                                                                | 133/222 [00:27<00:17,  5.11it/s]2023-04-16 23:11:10 - INFO - Epoch 3total_step 800eta 00:05:01:loss 0.405, acc 0.875
Evaluating: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10/10 [00:01<00:00,  9.21it/s]
2023-04-16 23:11:11 - INFO - current_score 0.7457954198838858█████████████████████████████████████████████████████████████████████████████████████████████████████▊                | 9/10 [00:01<00:00,  8.71it/s]
Training:: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 222/222 [00:45<00:00,  4.83it/s]
Evaluating: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10/10 [00:01<00:00,  9.14it/s]
2023-04-16 23:11:31 - INFO - best_score 0.7554248576070848
Training::   5%|███████▉                                                                                                                                                         | 11/222 [00:02<00:43,  4.90it/s]2023-04-16 23:11:34 - INFO - Epoch 4total_step 900eta 00:04:44:loss 0.100, acc 1.000
Evaluating: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10/10 [00:01<00:00,  9.06it/s]
2023-04-16 23:11:35 - INFO - current_score 0.7538052139673828█████████████████████████████████████████████████████████████████████████████████████████████████████▊                | 9/10 [00:01<00:00,  8.57it/s]
Training::  50%|████████████████████████████████████████████████████████████████████████████████                                                                                | 111/222 [00:22<00:21,  5.05it/s]2023-04-16 23:11:54 - INFO - Epoch 4total_step 1000eta 00:04:22:loss 0.090, acc 1.000
Evaluating: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10/10 [00:01<00:00,  9.31it/s]
2023-04-16 23:11:58 - INFO - best_score 0.7652314720735773████████████████████████████████████████████████████████████████████████████████████████████████████████▊                | 9/10 [00:01<00:00,  8.76it/s]
2023-04-16 23:11:58 - INFO - current_score 0.7652314720735773
Training::  95%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████        | 211/222 [00:45<00:02,  5.14it/s]2023-04-16 23:12:17 - INFO - Epoch 4total_step 1100eta 00:04:02:loss 0.071, acc 1.000
Evaluating: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10/10 [00:01<00:00,  9.30it/s]
2023-04-16 23:12:21 - INFO - best_score 0.7667217300489892████████████████████████████████████████████████████████████████████████████████████████████████████████▊                | 9/10 [00:01<00:00,  8.79it/s]
2023-04-16 23:12:21 - INFO - current_score 0.7667217300489892
Training:: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 222/222 [00:51<00:00,  4.33it/s]
Evaluating: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10/10 [00:01<00:00,  9.09it/s]
Training::  40%|████████████████████████████████████████████████████████████████▌                                                                                                | 89/222 [00:17<00:27,  4.82it/s]2023-04-16 23:12:42 - INFO - Epoch 5total_step 1200eta 00:03:42:loss 0.101, acc 1.000
Evaluating: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10/10 [00:01<00:00,  8.94it/s]
2023-04-16 23:12:45 - INFO - best_score 0.773688250493996█████████████████████████████████████████████████████████████████████████████████████████████████████████▊                | 9/10 [00:01<00:00,  8.30it/s]
2023-04-16 23:12:45 - INFO - current_score 0.773688250493996
Training::  85%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                       | 189/222 [00:40<00:06,  5.11it/s]2023-04-16 23:13:05 - INFO - Epoch 5total_step 1300eta 00:03:21:loss 0.075, acc 0.938
Evaluating: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10/10 [00:01<00:00,  8.99it/s]
2023-04-16 23:13:06 - INFO - current_score 0.7700963347633025█████████████████████████████████████████████████████████████████████████████████████████████████████▊                | 9/10 [00:01<00:00,  8.50it/s]
Training:: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 222/222 [00:48<00:00,  4.58it/s]
Evaluating: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10/10 [00:01<00:00,  9.24it/s]
Training::  30%|████████████████████████████████████████████████▌                                                                                                                | 67/222 [00:13<00:30,  5.10it/s]2023-04-16 23:13:27 - INFO - Epoch 6total_step 1400eta 00:02:59:loss 0.050, acc 1.000
Evaluating: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10/10 [00:01<00:00,  9.33it/s]
2023-04-16 23:13:28 - INFO - current_score 0.7701526255350246█████████████████████████████████████████████████████████████████████████████████████████████████████▊                | 9/10 [00:01<00:00,  8.77it/s]
Training::  75%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                       | 167/222 [00:34<00:10,  5.06it/s]2023-04-16 23:13:47 - INFO - Epoch 6total_step 1500eta 00:02:37:loss 0.029, acc 1.000
Evaluating: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10/10 [00:01<00:00,  9.15it/s]
2023-04-16 23:13:51 - INFO - best_score 0.7736995051731893████████████████████████████████████████████████████████████████████████████████████████████████████████▊                | 9/10 [00:01<00:00,  8.71it/s]
2023-04-16 23:13:51 - INFO - current_score 0.7736995051731893
Training:: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 222/222 [00:48<00:00,  4.61it/s]
Evaluating: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10/10 [00:01<00:00,  8.14it/s]
2023-04-16 23:14:05 - INFO - best_score 0.7754679679179979
Training::  20%|████████████████████████████████▋                                                                                                                                | 45/222 [00:10<00:42,  4.15it/s]2023-04-16 23:14:16 - INFO - Epoch 7total_step 1600eta 00:02:18:loss 0.017, acc 1.000
Evaluating: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10/10 [00:01<00:00,  8.38it/s]
2023-04-16 23:14:19 - INFO - best_score 0.7770306187968414████████████████████████████████████████████████████████████████████████████████████████████████████████▊                | 9/10 [00:01<00:00,  7.91it/s]
2023-04-16 23:14:19 - INFO - current_score 0.7770306187968414
Training::  65%|████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                                       | 145/222 [00:38<00:18,  4.13it/s]2023-04-16 23:14:43 - INFO - Epoch 7total_step 1700eta 00:01:57:loss 0.052, acc 1.000
Evaluating: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10/10 [00:01<00:00,  8.10it/s]
2023-04-16 23:14:47 - INFO - best_score 0.7787960676453558████████████████████████████████████████████████████████████████████████████████████████████████████████▊                | 9/10 [00:01<00:00,  7.61it/s]
2023-04-16 23:14:47 - INFO - current_score 0.7787960676453558
Training:: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 222/222 [01:00<00:00,  3.70it/s]
Evaluating: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10/10 [00:01<00:00,  8.28it/s]
Training::  10%|████████████████▋                                                                                                                                                | 23/222 [00:05<00:47,  4.16it/s]2023-04-16 23:15:12 - INFO - Epoch 8total_step 1800eta 00:01:36:loss 0.030, acc 1.000
Evaluating: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10/10 [00:01<00:00,  8.22it/s]
2023-04-16 23:15:13 - INFO - current_score 0.7786667730604072█████████████████████████████████████████████████████████████████████████████████████████████████████▊                | 9/10 [00:01<00:00,  7.70it/s]
Training::  55%|████████████████████████████████████████████████████████████████████████████████████████▋                                                                       | 123/222 [00:30<00:24,  4.11it/s]2023-04-16 23:15:37 - INFO - Epoch 8total_step 1900eta 00:01:13:loss 0.010, acc 1.000
Evaluating: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10/10 [00:01<00:00,  8.29it/s]
2023-04-16 23:15:38 - INFO - current_score 0.778780249129838██████████████████████████████████████████████████████████████████████████████████████████████████████▊                | 9/10 [00:01<00:00,  7.78it/s]
Training:: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 222/222 [00:55<00:00,  3.97it/s]
Evaluating: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10/10 [00:01<00:00,  8.19it/s]
2023-04-16 23:16:05 - INFO - best_score 0.7802658981839803
Training::   0%|▋                                                                                                                                                                 | 1/222 [00:00<00:54,  4.02it/s]2023-04-16 23:16:06 - INFO - Epoch 9total_step 2000eta 00:00:51:loss 0.066, acc 0.938
Evaluating: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10/10 [00:01<00:00,  8.39it/s]
2023-04-16 23:16:07 - INFO - current_score 0.7802658981839803█████████████████████████████████████████████████████████████████████████████████████████████████████▊                | 9/10 [00:01<00:00,  7.86it/s]
Training::  45%|████████████████████████████████████████████████████████████████████████▊                                                                                       | 101/222 [00:25<00:29,  4.14it/s]2023-04-16 23:16:31 - INFO - Epoch 9total_step 2100eta 00:00:28:loss 0.264, acc 0.875
Evaluating: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10/10 [00:01<00:00,  8.28it/s]
2023-04-16 23:16:32 - INFO - current_score 0.7802658981839803█████████████████████████████████████████████████████████████████████████████████████████████████████▊                | 9/10 [00:01<00:00,  7.79it/s]
Training::  91%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊               | 201/222 [00:50<00:05,  4.16it/s]2023-04-16 23:16:56 - INFO - Epoch 9total_step 2200eta 00:00:04:loss 0.213, acc 0.875
Evaluating: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10/10 [00:01<00:00,  8.29it/s]
2023-04-16 23:16:58 - INFO - current_score 0.7768035447047099█████████████████████████████████████████████████████████████████████████████████████████████████████▊                | 9/10 [00:01<00:00,  7.81it/s]
Training:: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 222/222 [00:57<00:00,  3.88it/s]
Evaluating: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10/10 [00:01<00:00,  8.20it/s